let ApolloError,verify,JWT_SECRET,User;_b51‍.x([["default",()=>_b51‍.o]]);_b51‍.w("apollo-server-express",[["ApolloError",["ApolloError"],function(v){ApolloError=v}]]);_b51‍.w("jsonwebtoken",[["verify",["verify"],function(v){verify=v}]]);_b51‍.w("../config",[["JWT_SECRET",["JWT_SECRET"],function(v){JWT_SECRET=v}]]);_b51‍.w("../models",[["User",["User"],function(v){User=v}]]);



const AuthMiddleware = async (req, res, next) => {
  const authHeader = req.get("Authorization");

  try {
    if (authHeader) {
      let token = authHeader.split(" ")[1];
      if (!token || token === "") {
        req.isAuth = false;
        next();
      } else {
        let decoded_Token = verify(token, JWT_SECRET);
        if (decoded_Token) {
          let authuser = await User.findById(decoded_Token.user._id);

          if (authuser) {
            req.user = authuser;
            req.isAuth = true;
            next();
          } else {
            req.isAuth = false;
            next();
          }
        } else {
          req.isAuth = false;
          next();
        }
      }
    } else {
      req.isAuth = false;
      next();
    }
  } catch (error) {
    throw new ApolloError(error.message, 401);
  }
};

_b51‍.d(AuthMiddleware);
